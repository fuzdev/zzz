import"../chunks/DsnmJJEf.js";import{p as Y,c as I,n as q,h as at,b as f,f as x,a as W,s as o,d as e,x as l,y as S,r as a,t as J,e as V,$ as ot,z as F,I as rt}from"../chunks/iOdzdy3x.js";import{s as L,d as X}from"../chunks/BEcV18IW.js";import{s as nt,r as it,p as M,i as H}from"../chunks/D_ShskPG.js";import{c as st,a as dt,b as lt}from"../chunks/BFdLDlKi.js";import{f as Z}from"../chunks/LkvzrlO1.js";import{t as ct,s as _t}from"../chunks/B-6PjeIb.js";import{C as vt,P as mt}from"../chunks/DStZKaXO.js";import{i as O,g as $,o as ut,C as ft,D as tt,t as ht}from"../chunks/BaMhdA5r.js";import{C as gt,a as bt,b as K}from"../chunks/D1l_bAsh.js";import{S as pt,s as Q,a as U}from"../chunks/EKLnCCRn.js";import{C as yt}from"../chunks/CWXyl83Z.js";import{D as xt,T as wt}from"../chunks/YdmxSrPV.js";import{a as kt}from"../chunks/BvkD_pH1.js";import{r as Ct}from"../chunks/CF_rgvJJ.js";var Pt=x("<span>delete from history</span>"),zt=x("<!> <!> <!> <!>",1);function Lt(w,t){Y(t,!0);const _=i=>{bt(i,{icon:n=>{O(n,{get glyph(){return $}})},menu:n=>{var m=zt(),s=W(m);K(s,{get content(){return t.action.method},label:"copy method"});var y=o(s,2);K(y,{get content(){return t.action.id},label:"copy id"});var d=o(y,2);K(d,{content:()=>t.action.json_serialized,label:"copy json data",show_preview:!1});var u=o(d,2);vt(u,{run:()=>{confirm("delete this action from history? that sounds destructive")&&v.actions.items.remove(t.action.id)},icon:c=>{O(c,{get glyph(){return ut}})},children:(c,j)=>{var r=Pt();f(c,r)},$$slots:{icon:!0,default:!0}}),f(n,m)},children:(n,m)=>{q();var s=at("action");f(n,s)},$$slots:{icon:!0,menu:!0,default:!0}})},h=it(t,["$$slots","$$events","$$legacy","action"]),v=Z.get();gt(w,nt(()=>h,{get entries(){return _}})),I()}var St=x('<button type="button"><div class="font-weight:400 display:flex align-items:center gap_xs width:100%"><!> <!> <span class="font_family_mono flex:1 ellipsis"> </span> <!> <small class="font_family_mono ml_auto"> </small></div></button>');function Tt(w,t){Y(t,!0);const _=M(t,"selected",3,!1);Lt(w,{get action(){return t.action},children:(h,v)=>{var i=St();let k;i.__click=()=>{t.onselect?.(t.action)};var p=e(i),n=e(p);{let r=S(()=>ft(t.action.method));O(n,{get glyph(){return l(r)}})}var m=o(n,2);{let r=S(()=>tt(t.action.kind));O(m,{get glyph(){return l(r)}})}var s=o(m,2),y=e(s,!0);a(s);var d=o(s,2);{var u=r=>{mt(r,{inline:!0})},C=r=>{var g=V(),P=W(g);{var D=E=>{O(E,{class:"color_c",get glyph(){return ht}})};H(P,E=>{t.action.has_error&&E(D)},!0)}f(r,g)};H(d,r=>{t.action.pending?r(u):r(C,!1)})}var c=o(d,2),j=e(c,!0);a(c),a(p),a(i),J(()=>{k=st(i,1,"width:100% text-align:left justify-content:start py_xs px_md border_radius_0 border-style:none box_shadow_none",null,k,{selected:_(),color_c:t.action.has_error}),L(y,t.action.method),L(j,t.action.created_formatted_time)}),ct(3,i,()=>_t),f(h,i)},$$slots:{default:!0}}),I()}X(["click"]);var jt=x('<div class="p_sm text-align:center"><small> </small></div>'),At=x("<div><!> <!></div>");function Dt(w,t){Y(t,!0);const _=M(t,"limit",3,20),h=M(t,"selected_action_id",3,null),v=Z.get(),{actions:i}=v,k=S(()=>i.items.size),p=S(()=>i.items.values.slice(0,_()));var n=At();dt(n,()=>({...t.attrs,class:`flex:1 unstyled overflow:auto scrollbar-width:thin ${t.attrs?.class??""}`}));var m=e(n);{const d=(C,c=ot)=>{{let j=S(()=>c().id===h());Tt(C,{get action(){return c()},get selected(){return l(j)},get onselect(){return t.onselect}})}};let u=S(()=>[Q("created_newest","newest first","created_date","desc"),Q("created_oldest","oldest first","created_date","asc"),U("method_asc","method (a-z)","method"),U("method_desc","method (z-a)","method","desc")]);pt(m,{get items(){return l(p)},get sorters(){return l(u)},sort_key_default:"created_newest",show_sort_controls:!0,no_items:"",children:d,$$slots:{default:!0}})}var s=o(m,2);{var y=d=>{var u=jt(),C=e(u),c=e(C);a(C),a(u),J(()=>L(c,`Showing ${_()??""} of ${l(k)??""} actions`)),f(d,u)};H(s,d=>{l(k)>_()&&d(y)})}a(n),f(w,n),I()}var Et=x("<tr><td>updated</td><td> </td></tr>"),Gt=x('<tr><td>error</td><td class="font_family_mono color_c"> </td></tr>'),Ot=x('<div class="mb_md"><h3 class="mt_md"><!> </h3> <table><tbody class="font_family_mono"><tr><td>id</td><td> </td></tr><tr><td>created</td><td> </td></tr><!><tr><td>kind</td><td> </td></tr><!></tbody></table></div> <div class="display:flex gap_md mb_sm"><!></div> <pre class="font_family_mono font_size_sm white-space:pre-wrap word-break:break-word p_sm width:100%"> </pre>',1);function Ht(w,t){Y(t,!0);var _=Ot(),h=W(_),v=e(h),i=e(v);{let b=S(()=>tt(t.action.kind));O(i,{get glyph(){return l(b)}})}var k=o(i);a(v);var p=o(v,2),n=e(p),m=e(n),s=o(e(m)),y=e(s,!0);a(s),a(m);var d=o(m),u=o(e(d)),C=e(u);a(u),a(d);var c=o(d);{var j=b=>{var G=Et(),R=o(e(G)),B=e(R);a(R),a(G),J(()=>L(B,`${t.action.updated_formatted_datetime??""}
						${t.action.updated_formatted_time??""}`)),f(b,G)};H(c,b=>{t.action.updated_formatted_datetime!==t.action.created_formatted_datetime&&b(j)})}var r=o(c),g=o(e(r)),P=e(g,!0);a(g),a(r);var D=o(r);{var E=b=>{var G=Gt(),R=o(e(G)),B=e(R,!0);a(R),a(G),J(et=>L(B,et),[()=>JSON.stringify(t.action.action_event_data.error)]),f(b,G)};H(D,b=>{t.action.action_event_data?.error&&b(E)})}a(n),a(p),a(h);var z=o(h,2),T=e(z);{let b=S(()=>JSON.stringify(t.action.json,null,2));yt(T,{get text(){return l(b)},class:"plain"})}a(z);var A=o(z,2),N=e(A,!0);a(A),J(b=>{L(k,` ${t.action.method??""}`),L(y,t.action.id),L(C,`${t.action.created_formatted_datetime??""}
					${t.action.created_formatted_time??""}`),L(P,t.action.kind),L(N,b)},[()=>JSON.stringify(t.action.json,null,2)]),f(w,_),I()}var Jt=x("<h1><!> system actions</h1>"),Nt=x('<div class="box height:100%"><p>select an action from the list or <button type="button" class="inline color_f">go fish</button> to view its details</p></div>'),Rt=x('<div class="box height:100%"><p>no actions yet, <button type="button" class="inline color_d">do something?</button>?</p></div>'),Yt=x(`<div class="column p_lg height:100%"><!> <p class="width_atmost_md">This page shows the actions that have happened behind the scenes. It's a work in progress and
		not too useful yet. The idea is to make the system visible, auditable, and manipulable.</p> <p class="row gap_sm"><button type="button" class="compact">clear action history</button> <button type="button" class="compact">ping</button></p> <div class="flex:1 display:grid overflow:hidden"><div class="overflow:auto scrollbar-width:thin border_right svelte-122qwj4"><!></div> <div class="panel p_md overflow:auto height:100%"><!></div></div></div>`);function It(w,t){Y(t,!0);const _=kt.get(),h=S(()=>_.actions);let v=rt(null);var i=Yt(),k=e(i);xt(k,{header:g=>{var P=Jt(),D=e(P);O(D,{get glyph(){return $}}),q(),a(P),f(g,P)},children:(g,P)=>{wt(g,{get value(){return _.time.now}})}});var p=o(k,4),n=e(p);n.__click=()=>{l(h).items.clear(),F(v,null)};var m=o(n,2);m.__click=()=>_.api.ping(),a(p);var s=o(p,2);lt(s,"",{},{"grid-template-columns":"320px 1fr",gap:"var(--space_md)"});var y=e(s),d=e(y);{let r=S(()=>l(v)?.id);Dt(d,{limit:100,get selected_action_id(){return l(r)},onselect:g=>{F(v,g,!0)}})}a(y);var u=o(y,2),C=e(u);{var c=r=>{Ht(r,{get action(){return l(v)}})},j=r=>{var g=V(),P=W(g);{var D=z=>{var T=Nt(),A=e(T),N=o(e(A));N.__click=()=>{F(v,Ct(l(h).items.values),!0)},q(),a(A),a(T),f(z,T)},E=z=>{var T=Rt(),A=e(T),N=o(e(A));N.__click=()=>{_.api.toggle_main_menu()},q(),a(A),a(T),f(z,T)};H(P,z=>{l(h).items.size>0?z(D):z(E,!1)},!0)}f(r,g)};H(C,r=>{l(v)?r(c):r(j,!1)})}a(u),a(s),a(i),J(()=>n.disabled=!l(h).items.size),f(w,i),I()}X(["click"]);function oe(w){It(w,{})}export{oe as component};
