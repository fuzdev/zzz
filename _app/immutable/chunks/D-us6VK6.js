import"./DsnmJJEf.js";import{s as F,d as st,a as Gt,o as Qt,c as Zt}from"./BEcV18IW.js";import{p as U,f as p,a as A,s as d,z as K,I as tt,x as a,b as i,c as W,n as X,h as et,d as r,r as e,t as q,y as R,e as Z,U as $t,$ as xt}from"./iOdzdy3x.js";import{p as $,s as kt,r as Pt,i as G}from"./D_ShskPG.js";import{a as gt,S as te,c as lt,s as mt,e as nt,f as ht,C as ee,b as Ht}from"./BFdLDlKi.js";import{r as ae}from"./CF_rgvJJ.js";import{C as dt,P as Ct}from"./DStZKaXO.js";import{M as zt,a as re,C as ne,b as se}from"./DbQ9iCG4.js";import{t as ot,s as ct,f as oe,b as ie}from"./B-6PjeIb.js";import{D as le}from"./DRImvtOl.js";import{i as V,V as Mt,c as de,o as wt,x as Tt,t as Rt,W as Et,B as ce,X as St,r as At,j as Yt,G as jt,z as _e,A as ve}from"./BaMhdA5r.js";import{C as ft}from"./BUdTUlvp.js";import{f as at}from"./LkvzrlO1.js";import{R as ue}from"./Cn7zRXx4.js";import{C as Lt,a as Ot,b as ut}from"./D1l_bAsh.js";import{e as me,P as he,a as ge,b as fe,g as pe,c as be,d as ye,h as Bt,T as xe}from"./DvWkrdWm.js";import{a as qt,M as we,P as ke}from"./WP1MSYGU.js";import{c as Pe}from"./dr4kURsa.js";import{b as It}from"./7UQNwviV.js";import{P as Nt}from"./CGnIVwsf.js";import{y as Ce,p as ze,D as yt}from"./CclMSJRC.js";import{D as Te}from"./BO5xLq8H.js";import{c as Le}from"./CsElDmwN.js";import{a as vt}from"./EKLnCCRn.js";import{E as Ee,T as De}from"./Db4yH4GM.js";import{E as Ge}from"./GpoyK2O_.js";import{E as He}from"./D6gcmofG.js";var Me=p("<span>clear conversation</span>"),Re=p("switch model &nbsp; <small> </small>",1),Se=p("<span>delete thread</span>"),Ae=p("<!> <!> <!> <!> <!>",1),Ye=p("<!> <!>",1);function Vt(D,t){U(t,!0);const o=v=>{Ot(v,{icon:u=>{V(u,{get glyph(){return Mt}})},menu:u=>{var P=Ae(),g=A(P);{var w=l=>{ut(l,{get content(){return s().content},label:"copy conversation",get preview(){return s().content_preview}})};G(g,l=>{s().content&&l(w)})}var c=d(g,2);{var f=l=>{dt(l,{run:()=>{s().remove_all_turns()},icon:M=>{V(M,{get glyph(){return Tt}})},children:(M,Y)=>{var E=Me();i(M,E)},$$slots:{icon:!0,default:!0}})};G(c,l=>{s().turns.size>0&&l(f)})}var z=d(c,2);me(z,{label:"thread",get enabled(){return s().enabled},set enabled(l){s().enabled=l}});var _=d(z,2);dt(_,{run:()=>{K(T,!0)},icon:L=>{V(L,{get glyph(){return de}})},children:(L,M)=>{X();var Y=Re(),E=d(A(Y)),H=r(E,!0);e(E),q(()=>F(H,s().model_name)),i(L,Y)},$$slots:{icon:!0,default:!0}});var h=d(_,2);dt(h,{run:()=>{confirm("Are you sure you want to delete this thread?")&&k.threads.remove(s().id)},icon:L=>{V(L,{get glyph(){return wt}})},children:(L,M)=>{var Y=Se();i(L,Y)},$$slots:{icon:!0,default:!0}}),i(u,P)},children:(u,P)=>{X();var g=et("thread");i(u,g)},$$slots:{icon:!0,menu:!0,default:!0}})},s=$(t,"thread",7),n=Pt(t,["$$slots","$$events","$$legacy","thread"]),k=at.get();let T=tt(!1);var m=Ye(),C=A(m);Lt(C,kt(()=>n,{get entries(){return o}}));var y=d(C,2);zt(y,{onpick:v=>{v&&s().switch_model(v.id)},get show(){return a(T)},set show(v){K(T,v,!0)}}),i(D,m),W()}var je=p("<input/>");function Oe(D,t){U(t,!0);const o=$(t,"thread",7);var s=je();gt(s,()=>({type:"checkbox",class:"plain compact",title:`this thread is ${o().enabled?"enabled":"disabled"} and ${o().enabled?"":"not "}included in the chat`,...t.attrs,[te]:{height:"auto"}}),void 0,void 0,void 0,void 0,!0),Pe(s,()=>o().enabled,n=>o().enabled=n),i(D,s),W()}var Be=p("<small> </small>"),qe=p('<div><div class="row justify-content:space-between gap_xs"><div class="flex:1"><div class="font-weight:400"><!> </div> <div class="display:flex gap_xs"><!></div></div> <div class="display:flex gap_xs"><!> <!></div></div></div>');function Ie(D,t){U(t,!0);const o=R(()=>t.thread.turns.size),s=R(()=>t.chat.view_mode==="simple"),n=R(()=>a(s)&&t.chat.selected_thread_id===t.thread.id);Vt(D,{get thread(){return t.thread},children:(k,T)=>{var m=qe();let C;m.__click=function(...h){(a(s)?()=>t.chat.select_thread(t.thread.id):void 0)?.apply(this,h)},m.__keydown=function(...h){(a(s)?l=>l.key==="Enter"&&t.chat.select_thread(t.thread.id):void 0)?.apply(this,h)};var y=r(m),v=r(y),b=r(v),x=r(b);qt(x,{get name(){return t.thread.model.provider_name},size:"var(--font_size_md)"});var u=d(x);e(b);var P=d(b,2),g=r(P);{var w=h=>{var l=Be(),L=r(l);e(l),q(()=>F(L,`${a(o)??""} message${a(o)!==1?"s":""}, ${t.thread.token_count??""} token${t.thread.token_count!==1?"s":""}`)),i(h,l)},c=h=>{var l=et(" ");i(h,l)};G(g,h=>{a(o)>0?h(w):h(c,!1)})}e(P),e(v);var f=d(v,2),z=r(f);Oe(z,{get thread(){return t.thread}});var _=d(z,2);ft(_,{onconfirm:()=>t.chat.remove_thread(t.thread.id),class:"icon_button plain",title:"delete thread",children:(h,l)=>{V(h,{get glyph(){return Tt}})},$$slots:{default:!0}}),e(f),e(y),e(m),q(()=>{C=lt(m,1,"thread_listitem p_xs2 svelte-1idcri0",null,C,{dormant:!t.thread.enabled,selected:a(n)}),mt(m,"role",a(s)?"button":void 0),mt(m,"tabindex",a(s)?0:void 0),F(u,` ${t.thread.model_name??""}`)}),i(k,m)},$$slots:{default:!0}}),W()}st(["click","keydown"]);var Ne=p('<li class="border_radius_xs"><!></li>'),Ve=p('<ul class="unstyled column gap_xs5"></ul>'),Fe=p('<p class="text-align:center">No chat selected</p>');function Ue(D,t){U(t,!0);const o=$(t,"chat",19,()=>at.get().chats.selected),s=new ue;var n=Z(),k=A(n);{var T=C=>{var y=Ve();nt(y,23,()=>o().threads,v=>v.id,(v,b,x)=>{var u=Ne(),P=r(u);Ie(P,{get thread(){return a(b)},get chat(){return o()}}),e(u),ht(u,()=>s.item({index:a(x)})),ot(3,u,()=>ct),i(v,u)}),e(y),ht(y,()=>s.list({onreorder:(v,b)=>{o().reorder_threads(v,b)}})),i(C,y)},m=C=>{var y=Fe();i(C,y)};G(k,C=>{o()?C(T):C(m,!1)})}i(D,n),W()}var We=p('<span class="color_c_50"><!> <!></span>');function Dt(D,t){const o=$(t,"glyph",3,Rt);var s=We(),n=r(s);{var k=m=>{V(m,{get glyph(){return o()}})};G(n,m=>{o()&&m(k)})}var T=d(n,2);Gt(T,()=>t.children),e(s),i(D,s)}var Je=p('<div><div class="display:flex mb_0 justify-content:space-between"><div class="font_size_lg m_0"><!> </div> <div class="display:flex gap_xs"><!> <!></div></div> <div><!></div> <!></div>'),Ke=p("parts not found: <code> </code>",1),Xe=p('<div class="p_sm"><!></div>');function Qe(D,t){U(t,!0);const o=$(t,"show_actions",3,!0),s=at.get(),{prompts:n}=s;Ft(D,{get turn(){return t.turn},children:(k,T)=>{var m=Z(),C=A(m);{var y=b=>{var x=Z(),u=A(x);nt(u,17,()=>t.turn.parts,P=>P.id,(P,g)=>{var w=Je();let c;var f=r(w),z=r(f),_=r(z);{let S=R(()=>pe(a(g)));V(_,{get glyph(){return a(S)}})}var h=d(_);e(z);var l=d(z,2),L=r(l);he(L,{get part(){return a(g)}});var M=d(L,2);ge(M,{get part(){return a(g)},get prompts(){return n}}),e(l),e(f);var Y=d(f,2),E=r(Y);{var H=S=>{be(S,{get text_part(){return a(g)},get show_actions(){return o()}})},I=S=>{var O=Z(),N=A(O);{var J=Q=>{ye(Q,{get diskfile_part(){return a(g)},get show_actions(){return o()}})};G(N,Q=>{a(g).type==="diskfile"&&Q(J)},!0)}i(S,O)};G(E,S=>{a(g).type==="text"?S(H):S(I,!1)})}e(Y);var j=d(Y,2);fe(j,{get part(){return a(g)}}),e(w),q(()=>{c=lt(w,1,"column gap_sm mb_md",null,c,{dormant:!a(g).enabled}),F(h,` 
						${a(g).name??""}`)}),i(P,w)}),i(b,x)},v=b=>{var x=Xe(),u=r(x);{var P=w=>{var c=Ke(),f=d(A(c)),z=r(f,!0);e(f),q(_=>F(z,_),[()=>t.turn.part_ids.join(", ")]),i(w,c)},g=w=>{var c=et("no parts in turn");i(w,c)};G(u,w=>{t.turn.part_ids.length>0?w(P):w(g,!1)})}e(x),i(b,x)};G(C,b=>{t.turn.parts.length>0?b(y):b(v,!1)})}i(k,m)},$$slots:{default:!0}}),W()}var Ze=p("<span>edit content</span>"),$e=p("<!> <!> <!> <!>",1),ta=p('<div class="pane p_md width_atmost_md mx_auto"><h2 class="mt_0 mb_sm"><!> edit turn</h2> <!></div>'),ea=p("<!> <!>",1);function Ft(D,t){U(t,!0);const o=y=>{Ot(y,{icon:x=>{V(x,{get glyph(){return Et}})},menu:x=>{var u=$e(),P=A(u);{var g=h=>{ut(h,{get content(){return t.turn.content},label:"copy content",get preview(){return t.turn.content}})};G(P,h=>{t.turn.content&&h(g)})}var w=d(P,2);dt(w,{run:()=>{K(n,!0)},icon:l=>{V(l,{get glyph(){return ce}})},children:(l,L)=>{var M=Ze();i(l,M)},$$slots:{icon:!0,default:!0}});var c=d(w,2);{var f=h=>{ut(h,{content:()=>JSON.stringify(t.turn.request,null,2),label:"copy request data",preview:""})};G(c,h=>{t.turn.request&&h(f)})}var z=d(c,2);{var _=h=>{ut(h,{content:()=>JSON.stringify(t.turn.response,null,2),label:"copy response data",preview:""})};G(z,h=>{t.turn.response&&h(_)})}i(x,u)},children:(x,u)=>{X();var P=et("turn");i(x,P)},$$slots:{icon:!0,menu:!0,default:!0}})},s=Pt(t,["$$slots","$$events","$$legacy","turn"]);let n=tt(!1);var k=ea(),T=A(k);Lt(T,kt(()=>s,{get entries(){return o}}));var m=d(T,2);{var C=y=>{Te(y,{onclose:()=>K(n,!1),children:(v,b)=>{var x=ta(),u=r(x),P=r(u);V(P,{get glyph(){return Et}}),X(),e(u);var g=d(u,2);Qe(g,{get turn(){return t.turn}}),e(x),i(v,x)},$$slots:{default:!0}})};G(m,y=>{a(n)&&y(C)})}i(D,k),W()}var aa=p('<span class="text_60 font_family_mono"> </span>'),ra=p('<div><div class="white-space:pre-wrap overflow-wrap:break-word"><small class="mr_xs font-weight:600"> </small> <!></div></div>');function na(D,t){U(t,!0),Ft(D,{get turn(){return t.turn},children:(o,s)=>{var n=ra();let k;var T=r(n),m=r(T),C=r(m);e(m);var y=d(m,2);{var v=x=>{Ct(x,{inline:!0})},b=x=>{var u=Z(),P=A(u);{var g=c=>{Dt(c,{children:(f,z)=>{X();var _=et();q(()=>F(_,t.turn.error_message)),i(f,_)},$$slots:{default:!0}})},w=c=>{var f=Z(),z=A(f);{var _=l=>{var L=et();q(()=>F(L,t.turn.content)),i(l,L)},h=l=>{var L=Z(),M=A(L);{var Y=H=>{var I=aa(),j=r(I);e(I),q(S=>F(j,`missing parts: ${S??""}`),[()=>t.turn.part_ids.join(", ")]),i(H,I)},E=H=>{Dt(H,{children:(I,j)=>{X();var S=et();q(()=>F(S,Ce)),i(I,S)},$$slots:{default:!0}})};G(M,H=>{t.turn.parts.length===0?H(Y):H(E,!1)},!0)}i(l,L)};G(z,l=>{t.turn.is_content_loaded?l(_):l(h,!1)},!0)}i(c,f)};G(P,c=>{t.turn.error_message?c(g):c(w,!1)},!0)}i(x,u)};G(y,x=>{t.turn.pending?x(v):x(b,!1)})}e(T),e(n),q(()=>{k=lt(n,1,"px_sm py_xl",null,k,{user:t.turn.role==="user",assistant:t.turn.role==="assistant",system:t.turn.role==="system",dormant:!t.turn.enabled}),mt(m,"title",t.turn.created),F(C,`@${t.turn.role??""}:`)}),i(o,n)},$$slots:{default:!0}}),W()}class sa{#t=tt();get target_class(){return a(this.#t)}set target_class(t){K(this.#t,t,!0)}#e=tt();get threshold(){return a(this.#e)}set threshold(t){K(this.#e,t,!0)}#a=tt(0);get scroll_y(){return a(this.#a)}set scroll_y(t){K(this.#a,t,!0)}#r=R(()=>this.scroll_y>this.threshold);get scrolled(){return a(this.#r)}set scrolled(t){K(this.#r,t)}constructor(t){this.target_class=t?.target_class??"scrolled",this.threshold=t?.threshold??0}container=t=>{const o=window.getComputedStyle(t),s=()=>{const k=o.flexDirection==="column-reverse";this.scroll_y=t.scrollTop*(k?-1:1)},n=Qt(t,"scroll",s);return s(),()=>{n()}};target=t=>(this.scrolled?t.classList.add(this.target_class):t.classList.remove(this.target_class),()=>{t.classList.remove(this.target_class)})}var oa=p("<li><!></li>"),ia=p('<div><ul class="unstyled"></ul></div>');function la(D,t){U(t,!0);const o=new sa,s=R(()=>t.thread.turns.values);var n=ia();gt(n,()=>({...t.attrs,class:`turn_list ${t.attrs?.class??""}`}),void 0,void 0,void 0,"svelte-1gyer40");var k=r(n);nt(k,21,()=>a(s),T=>T.id,(T,m)=>{var C=oa(),y=r(C);na(y,{get turn(){return a(m)}}),e(C),ot(3,C,()=>ct),i(T,C)}),e(k),e(n),ht(n,()=>o.container),ht(n,()=>o.target),i(D,n),W()}var da=p('<span class="ml_xs3" title="model loading"><!></span>'),ca=p('<span class="color_c_50 ml_sm"><!> </span>'),_a=p('<div><div class="display:flex justify-content:space-between align-items:start"><header><button type="button" class="plain compact font_size_lg text-align:left font-weight:400"> <!></button> <small><!><!></small></header></div> <!> <div><!></div></div> <!>',1);function Ut(D,t){U(t,!0);let o=$(t,"pending_element_to_focus_key",15),s=tt("");const n=R(()=>ze(a(s)));let k,T=tt(!1);const m=async()=>{const w=a(s).trim();if(!w){k?.focus();return}K(s,""),$t().then(()=>k?.focus()),K(T,!0),await t.onsend(w),K(T,!1)},C=R(()=>t.thread.turns.size),y=R(()=>!a(C));let v=tt(!1);const b=R(()=>t.thread.model.provider_name==="ollama"),x=R(()=>a(b)&&!t.thread.model.loaded),u=R(()=>t.thread.model.provider),P=R(()=>a(u)?.available?null:a(u)?.status&&!a(u).status.available?a(u).status.error:"provider unavailable"),g=R(()=>a(T)||!!a(P));we(D,{get model(){return t.thread.model},children:(w,c)=>{Vt(w,{get thread(){return t.thread},children:(f,z)=>{var _=_a(),h=A(_);gt(h,()=>({...t.attrs,class:`chat_thread ${t.attrs?.class??""}`,[ee]:{empty:a(y),dormant:!t.thread.enabled}}),void 0,void 0,void 0,"svelte-45mgqh");var l=r(h),L=r(l),M=r(L);M.__click=()=>K(v,!0);var Y=r(M),E=d(Y);{var H=B=>{var rt=da(),it=r(rt);Ct(it,{inline:!0}),e(rt),i(B,rt)};G(E,B=>{a(x)&&B(H)})}e(M);var I=d(M,2),j=r(I);ke(j,{get provider(){return a(u)},icon:"svg",icon_props:{size:"var(--font_size_sm)"},show_name:!0});var S=d(j);{var O=B=>{var rt=ca(),it=r(rt);V(it,{get glyph(){return Rt}});var bt=d(it);e(rt),q(()=>F(bt,` ${a(P)??""}`)),i(B,rt)};G(S,B=>{a(P)&&B(O)})}e(I),e(L),e(l);var N=d(l,2);{var J=B=>{la(B,{get thread(){return t.thread},get attrs(){return t.turns_attrs}})};G(N,B=>{a(C)&&B(J)})}var Q=d(N,2),_t=r(Q);It(Bt(_t,{get token_count(){return a(n)},get placeholder(){return At},show_stats:!0,show_actions:!0,get focus_key(){return t.focus_key},get content(){return a(s)},set content(B){K(s,B,!0)},get pending_element_to_focus_key(){return o()},set pending_element_to_focus_key(B){o(B)},children:(B,rt)=>{{let it=R(()=>a(P)?" color_c_50":""),bt=R(()=>a(u)?.available?`send ${a(n)} tokens to ${t.thread.model_name}`:a(P)??void 0);Nt(B,{get pending(){return a(T)},get disabled(){return a(g)},onclick:m,get class(){return`plain ${a(it)??""}`},get title(){return a(bt)},children:(Xt,Xa)=>{V(Xt,{get glyph(){return St}})},$$slots:{default:!0}})}},$$slots:{default:!0}}),B=>k=B,()=>k),e(Q),e(h);var pt=d(h,2);zt(pt,{onpick:B=>{B&&t.thread.switch_model(B.id)},get show(){return a(v)},set show(B){K(v,B,!0)}}),q(()=>F(Y,`${t.thread.model.name??""} `)),i(f,_)},$$slots:{default:!0}})},$$slots:{default:!0}}),W()}st(["click"]);var va=p('<button type="button" class="listitem compact width:100%"><!></button>');function Wt(D,t){U(t,!0);const o=at.get(),{models:s}=o,n=$(t,"items",19,()=>s.ordered_by_name),k=$(t,"heading",3,"pick a model");{const T=(C,y=xt,v=xt)=>{var b=va();b.__click=()=>v()(y());var x=r(b);re(x,{get model(){return y()}}),e(b),i(C,b)};let m=R(()=>[vt("name_asc","name (a-z)","name"),vt("name_desc","name (z-a)","name","desc"),vt("provider_asc","provider (a-z)","provider_name"),vt("provider_desc","provider (z-a)","provider_name","desc")]);Le(D,{get items(){return n()},get onpick(){return t.onpick},get filter(){return t.filter},get sorters(){return a(m)},sort_key_default:"name_asc",show_sort_controls:!0,get heading(){return k()},children:T,$$slots:{default:!0}})}W()}st(["click"]);var ua=p('<div><header class="mb_md font_size_lg">add by model</header> <!> <!></div>');function Jt(D,t){U(t,!0);var o=ua();gt(o,()=>({...t.attrs,class:`p_sm $${t.attrs?.class??""}`}));var s=d(r(o),2);Wt(s,{onpick:k=>{k&&t.chat.add_thread(k)},heading:null});var n=d(s,2);Gt(n,()=>t.children??xt),e(o),i(D,o),W()}var ma=p("<span> </span>"),ha=p('<button type="button" class="width:100% font_size_sm py_xs3 justify-content:space-between plain border_radius_xs font-weight:600"><span> </span> <!></button>'),ga=p("<span> </span>"),fa=p("<span> </span> <!>",1),pa=p('<div><div class="display:flex"><div class="flex:1 p_xs"><header class="font_size_lg text-align:center mb_xs">add by tag</header> <menu class="unstyled column"></menu></div> <div class="flex:1 p_xs shade_10"><header class="font_size_lg text-align:center mb_xs">remove by tag</header> <menu class="unstyled column"></menu></div></div></div>');function Kt(D,t){U(t,!0);const o=R(()=>t.chat.app),s=R(()=>Array.from(a(o).tags));var n=pa(),k=r(n),T=r(k),m=d(r(T),2);nt(m,20,()=>a(s),v=>v,(v,b)=>{const x=R(()=>a(o).models.filter_by_tag(b));var u=ha();u.__click=()=>{t.chat.add_threads_by_model_tag(b)},Ht(u,"",{},{"min-height":"0"});var P=r(u),g=r(P,!0);e(P);var w=d(P,2);{var c=f=>{var z=ma(),_=r(z,!0);e(z),q(()=>F(_,a(x).length)),i(f,z)};G(w,f=>{a(x).length&&f(c)})}e(u),q(()=>F(g,b)),i(v,u)}),e(m),e(T);var C=d(T,2),y=d(r(C),2);nt(y,20,()=>a(s),v=>v,(v,b)=>{const x=R(()=>t.chat.threads.filter(u=>u.model.tags.includes(b)));{let u=R(()=>!a(x).length);ft(v,{get disabled(){return a(u)},class:"width:100% font_size_sm py_xs3 justify-content:space-between plain border_radius_xs font-weight:600",style:"min-height: 0;",onconfirm:()=>{t.chat.remove_threads_by_model_tag(b)},children:(P,g)=>{var w=fa(),c=A(w),f=r(c,!0);e(c);var z=d(c,2);{var _=h=>{var l=ga(),L=r(l,!0);e(l),q(()=>F(L,a(x).length)),i(h,l)};G(z,h=>{a(x).length&&h(_)})}q(()=>F(f,b)),i(P,w)},$$slots:{default:!0}})}}),e(y),e(C),e(k),e(n),i(D,n),W()}st(["click"]);var ba=p("<div><div><!></div></div>"),ya=p('<section class="column_section"><!></section> <section class="column_section"><!></section>',1);function xa(D,t){U(t,!0);const o=$(t,"chat",7),s=R(()=>t.thread?.turns.size),n=R(()=>!a(s));var k=Z(),T=A(k);{var m=y=>{var v=ba();let b,x;var u=r(v);let P;var g=r(u),w=()=>o().app.ui.pending_element_to_focus_key,c=f=>{o().app.ui.pending_element_to_focus_key=f};{let f=R(()=>({class:a(n)?"floating p_sm":"height:100%"}));Ut(g,{get thread(){return t.thread},onsend:z=>o().send_to_thread(t.thread.id,z),get attrs(){return a(f)},get focus_key(){return o().id},get pending_element_to_focus_key(){return w()},set pending_element_to_focus_key(z){c(z)}})}e(u),e(v),q(()=>{b=lt(v,1,"column_fluid column flex:1",null,b,{pr_xl:a(n)}),x=Ht(v,"",x,{overflow:a(n)?"visible":void 0,"justify-content":a(n)?"center":void 0}),P=lt(u,1,"column width_atmost_md width_atleast_sm",null,P,{height_100:!a(n),p_sm:!a(n)})}),i(y,v)},C=y=>{var v=ya(),b=A(v),x=r(b);Jt(x,{get chat(){return o()}}),e(b);var u=d(b,2),P=r(u);Kt(P,{get chat(){return o()}}),e(u),i(y,v)};G(T,y=>{t.thread?y(m):y(C,!1)})}i(D,k),W()}var wa=p("<!> ",1),ka=p("<!>&nbsp; remove all",1),Pa=p("<li><!></li>"),Ca=p('<div class="column_fluid"><div class="column_bg_1 p_sm"><!> <div class="display:flex mt_lg"><button type="button" class="plain"><!>&nbsp; add thread</button> <!></div> <ul class="threads unstyled mt_lg svelte-1qpknub"></ul></div></div> <!>',1);function za(D,t){U(t,!0);const o=$(t,"chat",7);let s,n=tt(!1);const k=async()=>{if(!a(T))return;const _=o().main_input.trim();if(!_){s?.focus();return}o().main_input="",K(n,!0),await o().send_to_all(_),K(n,!1)},T=R(()=>o().enabled_threads.length);let m=tt(!1);var C=Ca(),y=A(C),v=r(y),b=r(v),x=()=>o().app.ui.pending_element_to_focus_key,u=_=>{o().app.ui.pending_element_to_focus_key=_};It(Bt(b,{get token_count(){return o().main_input_token_count},get placeholder(){return`${At} to ${a(T)??""}`},show_actions:!0,show_stats:!0,get focus_key(){return o().id},get pending_element_to_focus_key(){return x()},set pending_element_to_focus_key(_){u(_)},get content(){return o().main_input},set content(_){o().main_input=_},children:(_,h)=>{{let l=R(()=>a(T)?void 0:!0);Nt(_,{get pending(){return a(n)},onclick:k,get disabled(){return a(l)},class:"plain",children:(L,M)=>{var Y=wa(),E=A(Y);V(E,{get glyph(){return St}});var H=d(E);q(()=>F(H,` to ${a(T)??""}`)),i(L,Y)},$$slots:{default:!0}})}},$$slots:{default:!0}}),_=>s=_,()=>s);var P=d(b,2),g=r(P);g.__click=()=>K(m,!0);var w=r(g);V(w,{get glyph(){return Yt}}),X(),e(g);var c=d(g,2);{let _=R(()=>!a(T));ft(c,{onconfirm:()=>o().remove_all_threads(),position:"right",get disabled(){return a(_)},class:"plain",children:(h,l)=>{var L=ka(),M=A(L);V(M,{get glyph(){return Tt}}),X(),i(h,L)},$$slots:{default:!0}})}e(P);var f=d(P,2);nt(f,21,()=>o().threads,_=>_.id,(_,h)=>{var l=Pa(),L=r(l);Ut(L,{get thread(){return a(h)},onsend:M=>o().send_to_thread(a(h).id,M),turns_attrs:{class:"max_height_sm"},attrs:{class:"p_md"}}),e(l),ot(1,l,()=>ct),i(_,l)}),e(f),e(v),e(y);var z=d(y,2);zt(z,{onpick:_=>{_&&o().add_thread(_)},get show(){return a(m)},set show(_){K(m,_,!0)}}),i(D,C),W()}st(["click"]);var Ta=p('<h2 class="mt_0 mb_lg"> </h2>'),La=p("<!>&nbsp;",1),Ea=p('<small class="chip"><!> </small>'),Da=p('<button type="button" class="plain selectable width:100% py_sm text-align:left justify-content:start font-weight:400"><div><div class="font_size_lg mb_sm"> </div> <div class="display:flex flex-wrap:wrap gap_xs2"></div></div></button>'),Ga=p('<!> <div class="display:flex"><section class="width_atmost_sm width_atleast_sm"><h3 class="mt_0 mb_lg">with model</h3> <!></section> <section class="width_atmost_sm width_atleast_sm"><h3 class="mt_0 mb_lg px_md">from template</h3> <menu class="unstyled column gap_xs px_md"></menu></section></div>',1);function Ha(D,t){U(t,!0);const o=at.get(),s=$(t,"heading",3,"create new chat"),n=()=>t.chat??o.chats.add(),k=g=>{const w=n(),c=o.models.filter_by_names(g.model_names);if(c&&c.length>0){for(const f of c)w.add_thread(f);c.length>=2&&(w.view_mode="multi")}t.oninit?.(w.id)},T=g=>{const w=n();w.add_thread(g),t.oninit?.(w.id)};var m=Ga(),C=A(m);{var y=g=>{var w=Ta(),c=r(w,!0);e(w),q(()=>F(c,s())),i(g,w)};G(C,g=>{s()&&g(y)})}var v=d(C,2),b=r(v),x=d(r(b),2);Wt(x,{onpick:g=>{g&&T(g)},get items(){return t.items},heading:""}),e(b);var u=d(b,2),P=d(r(u),2);nt(P,21,()=>o.chats.chat_templates,g=>g.id,(g,w)=>{var c=Da();c.__click=()=>k(a(w));var f=r(c),z=r(f),_=r(z,!0);e(z);var h=d(z,2);nt(h,20,()=>a(w).model_names,l=>l,(l,L)=>{const M=R(()=>o.models.find_by_name(L)?.provider_name);var Y=Ea(),E=r(Y);{var H=j=>{var S=La(),O=A(S);qt(O,{get name(){return a(M)},size:"var(--font_size_xs)"}),X(),i(j,S)};G(E,j=>{a(M)&&j(H)})}var I=d(E,1,!0);e(Y),q(()=>F(I,L)),i(l,Y)}),e(h),e(f),e(c),q(()=>F(_,a(w).name)),i(g,c)}),e(P),e(u),e(v),i(D,m),W()}st(["click"]);var Ma=p('<section class="column_section"><div class="font_size_lg display:flex align-items:center"><!> <!></div> <div class="row"><small class="flex:1"> </small> <div class="row gap_xs py_xs"><!> <!></div></div></section>'),Ra=p('<section class="column_section"><header class="mt_0 mb_lg font_size_lg display:flex justify-content:space-between" title="threads are the individual threads of conversation in a chat -- each chat can have many threads, comprising its history"><span><!> threads</span><span> </span></header> <!></section>'),Sa=p('<section class="column_section"><!></section> <section class="column_section"><!></section>',1),Aa=p('<div class="column_fluid p_md"><!></div>'),Ya=p('<div class="flex:1 height:100% display:flex align-items:start"><div class="column_fixed"><!> <!> <!></div> <!></div>');function ja(D,t){U(t,!0);const o=at.get(),{chats:s}=o,n=$(t,"chat",7),k=R(()=>n().threads.length);var T=Ya(),m=r(T),C=r(m);{var y=c=>{var f=Ma(),z=r(f),_=r(z);V(_,{get glyph(){return jt}});var h=d(_,2);Ee(h,{get value(){return n().name},set value(j){n().name=j}}),e(z);var l=d(z,2),L=r(l),M=r(L);e(L);var Y=d(L,2),E=r(Y);{var H=j=>{var S=()=>n().view_mode==="simple",O=N=>n().view_mode=N?"simple":"multi";{let N=R(()=>n().view_mode==="multi"?"simple":"multi");xe(j,{get active(){return S()},set active(J){O(J)},active_content:"simple",inactive_content:"multi",class:"plain compact",get title(){return`toggle chat to $${a(N)??""} view`},children:(J,Q)=>{V(J,{get glyph(){return _e},class:"mr_xs"})},$$slots:{default:!0}})}};G(E,j=>{a(k)&&j(H)})}var I=d(E,2);{const j=O=>{V(O,{get glyph(){return wt}})};let S=R(()=>'"'+n().name+'"');ft(I,{onconfirm:()=>n().id&&s.remove(n().id),get title(){return`delete chat ${a(S)??""}`},class:"plain icon_button",popover_button_content:j,children:(O,N)=>{V(O,{get glyph(){return wt}})},$$slots:{popover_button_content:!0,default:!0}})}e(Y),e(l),e(f),q(()=>{mt(L,"title",n().created_formatted_datetime),F(M,`created ${n().created_formatted_short_date??""}`)}),ot(3,f,()=>ct),i(c,f)};G(C,c=>{n()&&c(y)})}var v=d(C,2);{var b=c=>{var f=Ra(),z=r(f),_=r(z),h=r(_);V(h,{get glyph(){return Mt}}),X(),e(_);var l=d(_),L=r(l,!0);e(l),e(z);var M=d(z,2);Ue(M,{get chat(){return n()}}),e(f),q(()=>F(L,a(k))),i(c,f)};G(v,c=>{a(k)&&(n().view_mode!=="simple"||a(k)>1)&&c(b)})}var x=d(v,2);{var u=c=>{le(c,{summary:z=>{X();var _=et("manage threads");i(z,_)},children:(z,_)=>{var h=Sa(),l=A(h),L=r(l);Jt(L,{get chat(){return n()}}),e(l);var M=d(l,2),Y=r(M);Kt(Y,{get chat(){return n()}}),e(M),i(z,h)},$$slots:{summary:!0,default:!0}})};G(x,c=>{n().view_mode==="multi"&&c(u)})}e(m);var P=d(m,2);{var g=c=>{var f=Aa(),z=r(f);Ha(z,{get chat(){return n()},oninit:_=>s.navigate_to(_)}),e(f),i(c,f)},w=c=>{var f=Z(),z=A(f);{var _=l=>{xa(l,{get chat(){return n()},get thread(){return n().current_thread}})},h=l=>{za(l,{get chat(){return n()}})};G(z,l=>{n().view_mode==="simple"?l(_):l(h,!1)},!0)}i(c,f)};G(P,c=>{a(k)?c(w,!1):c(g)})}e(T),i(D,T),W()}var Oa=p("<span>create new chat</span>");function Ba(D,t){U(t,!0);const o=k=>{dt(k,{run:()=>{n.chats.add(void 0,!0)},icon:m=>{V(m,{get glyph(){return jt}})},children:(m,C)=>{var y=Oa();i(m,y)},$$slots:{icon:!0,default:!0}})},s=Pt(t,["$$slots","$$events","$$legacy"]),n=at.get();Lt(D,kt(()=>s,{get entries(){return o}})),W()}var qa=p(`<div class="pt_lg"><div><aside><p>This currently supports chatting with local models via Ollama, and if you bring your own
					API key, it supports basic text chat with ChatGPT, Claude, and Gemini. It's still early,
					share your ideas in the <!>.</p> <button type="button" class="compact">k</button></aside></div></div>`);function Ia(D,t){U(t,!0);const o=at.get();var s=Z(),n=A(s);{var k=T=>{var m=qa(),C=r(m),y=r(C),v=r(y),b=d(r(v));Ge(b,{href:"https://github.com/fuzdev/zzz/discussions",children:(u,P)=>{X();var g=et("discussions");i(u,g)},$$slots:{default:!0}}),X(),e(v);var x=d(v,2);x.__click=()=>{o.ui.tutorial_for_chats=!1},e(y),e(C),e(m),ot(2,y,()=>oe,()=>({duration:yt,x:-10,y:-1})),ot(2,C,()=>ie,()=>({duration:yt})),ot(2,m,()=>ct,()=>({delay:yt})),i(T,m)};G(n,T=>{o.ui.tutorial_for_chats&&T(k)})}i(D,s),W()}st(["click"]);var Na=p('<button type="button" title="toggle sort controls"><!></button>'),Va=p(`<p>Backend is not available. Chats require a backend connection to communicate with AI
						models.</p> <p class="mt_md"><button type="button">retry connection</button></p>`,1),Fa=p('<div class="box mt_lg"><!></div>'),Ua=p('<div class="box mt_lg"><blockquote>checking backend connection <!></blockquote></div>'),Wa=p('<div class="box height:100% flex:1"><div class="p_md text-align:center"><p>select a chat from the list, <button type="button" class="inline color_d">create a new chat</button>, or <button type="button" class="inline color_f">go fish</button>?</p></div></div>'),Ja=p('<div class="box height:100%"><p>no chats yet, <button type="button" class="inline color_d">create a new chat</button>?</p></div>'),Ka=p('<div class="column_fixed"><div class="py_sm pr_sm"><div class="row gap_xs2 mb_xs pl_xs2"><button class="plain flex:1 justify-content:start" type="button"><!>&nbsp; new chat</button> <!></div> <!></div> <!> <!> <!></div> <div class="column_fluid"><!></div>',1);function Pr(D,t){U(t,!0);const o=at.get(),{chats:s,capabilities:n}=o;Zt(()=>{n.init_backend_check()}),Ba(D,{attrs:{class:"display:flex width:100% height:100%"},children:(k,T)=>{var m=Ka(),C=A(m),y=r(C),v=r(y),b=r(v);b.__click=()=>s.add(void 0,!0);var x=r(b);V(x,{get glyph(){return Yt}}),X(),e(b);var u=d(b,2);{var P=E=>{var H=Na();let I;H.__click=()=>s.toggle_sort_controls();var j=r(H);V(j,{get glyph(){return ve}}),e(H),q(()=>I=lt(H,1,"plain compact selectable deselectable",null,I,{selected:s.show_sort_controls})),i(E,H)};G(u,E=>{s.items.size>1&&E(P)})}e(v);var g=d(v,2);{var w=E=>{ne(E,{})};G(g,E=>{s.items.size&&E(w)})}e(y);var c=d(y,2);De(c,{});var f=d(c,2);Ia(f,{});var z=d(f,2);{var _=E=>{var H=Fa(),I=r(H);He(I,{children:(j,S)=>{var O=Va(),N=d(A(O),2),J=r(N);J.__click=()=>n.check_backend(),e(N),q(()=>J.disabled=n.backend.status==="pending"),i(j,O)},$$slots:{default:!0}}),e(H),i(E,H)},h=E=>{var H=Z(),I=A(H);{var j=S=>{var O=Ua(),N=r(O),J=d(r(N));Ct(J,{inline:!0}),e(N),e(O),i(S,O)};G(I,S=>{(n.backend_available===null||n.backend_available===void 0)&&S(j)},!0)}i(E,H)};G(z,E=>{n.backend_available===!1?E(_):E(h,!1)})}e(C);var l=d(C,2),L=r(l);{var M=E=>{se(E,{get chat(){return s.selected},children:(H,I)=>{ja(H,{get chat(){return s.selected}})},$$slots:{default:!0}})},Y=E=>{var H=Z(),I=A(H);{var j=O=>{var N=Wa(),J=r(N),Q=r(J),_t=d(r(Q));_t.__click=()=>s.add(void 0,!0);var pt=d(_t,2);pt.__click=()=>{const B=ae(s.ordered_items);s.navigate_to(B.id)},X(),e(Q),e(J),e(N),i(O,N)},S=O=>{var N=Ja(),J=r(N),Q=d(r(J));Q.__click=()=>s.add(void 0,!0),X(),e(J),e(N),i(O,N)};G(I,O=>{s.items.size?O(j):O(S,!1)},!0)}i(E,H)};G(L,E=>{s.selected?E(M):E(Y,!1)})}e(l),i(k,m)},$$slots:{default:!0}}),W()}st(["click"]);export{Pr as D};
